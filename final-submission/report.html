<!DOCTYPE html>
<html lang="en">
<head>
    <title>Visualization Report</title>
    <!-- link to css -->
    <link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://getbootstrap.com/examples/justified-nav/justified-nav.css" rel="stylesheet">
    <link href="css/mystyle.css" rel="stylesheet">

    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <meta charset="utf-8">
</head>
 
<body>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Report (available as <a href="../finalassignment_ernie-tsang_jeremy-lo.pdf" target="_blank">PDF</a>)</h1>
                <a href="index.html">&#8592; Back to the visualizations</a>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <h3>Overview</h3>
                <p>
                This project originated on the curiosity of newly hired grads looking for more information about the changing scope of real estate in relation to their own earning power in the near future: how are things changing? Are prices hovering at an attainable range, or fluctuating outside the realm of possibility? Many young people, emerging from school, would like the ability to evaluate the current climate of real estate before pushing towards a home in any city in the Surrey. Our team has gathered various data surrounding the city of Surrey to investigate what’s changing about the city, and whether those changes bode well for potential buyers with modest salaries.
                </p>
            </div>
            <div class="col-md-8">
                <h3>Introduction</h3>
                <p>
                    Our visualizations are meant to shed some light on the underlying patterns in real estate for various neighborhoods found in Surrey. By examining data provided by both Surrey and the Greater Vancouver area, we can hopefully gain some insights to when someone might have luck finding a home, and how much it will end up costing them proportionally to their finances.
                </p>

                <p>
                    Young jobseekers and new graduates are the primary audience for our visualizations. These people are typically between 22 and 27, with a post-secondary education, looking to someday purchase a home in the north, south, or central regions of Surrey. With their youth and inexperience in the workforce, introductory salaries ranging from $40,000 to $65,000 CAD annually is expected -- certainly not in the territory of hedge fund managers or venture capitalists. Though lifestyles in this age bracket are subject to change, it is assumed that the number of children for this primary audience will be between 0 and 3. 
                </p>

                <p>
                    For the secondary audience, realtors and investors aged 30 to 50 with an interest in Surrey properties for the purpose of profit and trends before residence. While the information is not of the highest fidelity, there is no reason that more educated audiences won’t be able to read and enjoy the graphs.
                </p>
            </div>
        </div> <!-- end of .row -->

        <div class="row">
            <div class="col-md-8">
                <h3>The Data</h3>
                <p>
                    All of our data comes from official open data that have been released by the city of Surrey, where possible (income data was gathered from the Greater Vancouver region). All of our data utilizes time as a reference so that viewers can see trends. Other dimensions used include values such as active listings, population, House Price Index, and median income. 
                </p>
                <p>
                    Since the data that Surrey provides are extensive and detailed, we had to clean up the data. Originally, the HPI and income are from two separate sources. We combined them together so that these two pieces of data can be compared together across 3 or 4 columns. Furthermore, both Listings and population had more specific regions such as Guildford and Fleetwood but we ended up compressing these regions together into North (Delta), Central, and South (Whiterock).
                </p>
                <p>
                    Cleaning happened in 2 ways: either the incoming data had its cells pruned and extracted (population, income), or the data was manually entered to a CSV sheet from a PDF (housing price index). WIth the variety of data formats, sometimes manual data entry was necessary, as it’s very difficult to automate the scanning of long PDFs to find 3 values.
                </p>
            </div>

            <div class="col-md-4">
                <h3>Problem &amp; Domain Questions</h3>
                <ul>
                    <li>
                        Is now a good time to purchase a home?
                        <ul>
                            <li>If so, which region and which type of house to purchase?</li>
                            <li>If not, when is a good time?</li>
                        </ul>
                    </li>
                    <li>
                        How well is the salary of earners in the city doing in comparison to the price of property?
                        <ul>
                            <li>Is the median salary changing in a positive way?</li>
                            <li>Is the price of property changing at a desirable rate?</li>
                            <li>If either are changing, will property remain realistically affordable for the average worker in the Greater Vancouver area?</li>
                        </ul>
                    </li>
                </ul>
            </div>
            
        </div> <!-- end of .row -->

        <div class="row">
            <div class="col-md-12">
                <h3>Visualization Design</h3>
                <p>
                    Overall, there are 3 total sets of data we’ve chosen to examine in our graphs:
                    <ul>
                        <li>Number of available property listings across North Surrey (Delta), Central Surrey, and South Surrey (Whiterock)</li>
                        <li>Changes in population year over year in these 3 Surrey regions</li>
                        <li>Total median income for Greater Vancouver vs. Surrey Housing Price Index (HPI)</li>
                    </ul>
                    Originally, the first set of data was to be mapped to one graph: 3 different types of listings across 3 regions, which we decided to map to a line graph, categorizing both region and listing type with colour. This decision was made to reveal the trend across listings: are more listings popping up yearly, or are they in a decline? In order to also expose the details of the active listings, we’ve also opted for a dotted plot on the lines that reveal the specific data points to make the graph more readable.
                </p>
                <p>
                    Unfortunately, the first iteration graph was too crowded: 9 lines of different colours do not effectively sit on the same graph. Filtering was implemented to reduce the noise between lines, but it introduced issues with memory. By hiding other lines, it was difficult to recall what values the other lines had, so the decision was made to split the graph into 3 using small multiple views. Each graph measured only 1 type of property listing (apartment, townhouse, detached home), reducing the number of colours and lines per graph to 3. Having the data split across these smaller views made the information much easier to consume, as the visual noise was reduced.
                </p>
            </div>

        </div> <!-- end of .row -->

        <div class="row spaced">
            <div id="detached" class="col-md-12">

                <svg id="detached_vis"></svg>
                <p><em>Pictured: One of the Small Multiple graphs used</em></p>

            </div>
        </div> <!-- end of .row -->

        <div class="row">
            <div class="col-md-12">
                <p>
                    A similar situation arose for the <strong>Population Graph</strong>. By using data from 2004 to 2014, we wanted to explore trends again in the 3 regions of Surrey. For each of the 3 regions, how have the overall populations changed? Will the trend in population appear similar at all to the number of active listings, or reveal a correlation? This solution also leverages details on demand via hovers, exposing explicit values on mouse hover over each point on the lines.
                </p>
            </div>
        </div> <!-- end of .row -->

        <div class="row spaced">
            <div id="population" class="col-md-12">                
                <svg id="population_vis"></svg>
                <p><em>Pictured: the graph of population trends from 2004-2014</em></p>
            </div>
        </div> <!-- end of .row -->

        <div class="row">
            <div class="col-md-12">
                <p>
                    For the <strong>HPI-Income graph</strong>, we wanted to expose the difference between Housing Price Index and Income, as pairs. With this in mind, a paired bar graph was implemented. By placing the values next to each other, examining the difference between the values is simple. Time is used on the x-axis to also display the longer term behaviour of both values. This ended up exposing the startling changes in the housing price index, compared to the relatively stagnant median annual income.
                </p>
            </div>
        </div> <!-- end of .row -->

        <div class="row spaced">
            <div id="paired" class="col-md-12">
                <svg id="paired_vis"></svg>
                <p><em>Pictured: comparison graph between Housing Price Index (HPI) and annual income</em></p>
            </div>
        </div> <!-- end of .row -->

        <div class="row">
            <div class="col-md-12">
                <p>
                    Through the graphs, the North (blue), Central (green), and South (orange) region data is mapped to the same colours. Scale is maintained as a constant between the active listing graphs, in order to expose the differences between each listing type.
                </p>
                <p>
                    Interactions in our visualization are limited to mouse over events. By hovering over any particular value (circular line point or bar graph element), you can view its value while brushing the value itself to a different colour.
                </p>
            </div>
        </div> <!-- end of .row -->

        <div class="row">
            <div class="col-md-4">
                <h3>Further Work</h3>
                <p>
                    We managed to implement the base features showing our visualizations in a static way with some minor interactions. What would have been the next step would be some more advanced brushing and more comprehensive comparison tools between values. While there is continuity between some of our visualizations, currently there is little interaction between the data - it would be quite beneficial to be able to select a data point and compare it to other values across the other graphs on the page.
                </p>
                <p>
                    Being able to unify the graphs further through time would also be beneficial: brushing columns in each of the graphs based on a year selection and retrieving statistics from those years in a “summary” section.
                </p>
            </div>

            <div class="col-md-8">
                <h3>Conclusion</h3>
                <p>
                    The visualizations our team managed to produce some interesting trends. Active listings tend to pulse in the summer, with most listings closing by the beginning of the next year. In terms of the most popular type of listing by far turned out to be detached homes in Central Surrey, capping out at almost 1400 in the summer of 2010. If anyone was attempting to buy a home, they’d have the widest range of choice just after May in all 3 regions, no matter what type of property is up for sale.
                </p>
                <p>
                    Population over the past 10 years in Surrey has seen a steady, almost linear increase. There is a small spike in 2007 across the 3 regions of interest, but other than that the stream of new residents is fairly calm.
                </p>
                <p>
                    Finally, for Housing Price Index and median annual income, the data has shown that although Greater Vancouver’s median income is overall increasing, it is not increasing in a magnitude significant enough when compared to the Housing Price Index. HPI managed to jump up by $75,000 CAD in just 8 years, with median annual income increasing only by ~$13,000. If this trend continues, many new graduates entering the workforce will not likely be able to save for a home, as the price simply continues to climb at a rate that yearly wages cannot keep up with.
                </p>
            </div>
        </div> <!-- end of .row -->

        <div class="row spaced">
            <div class="col-md-12">
                <a href="index.html">&#8592; Back to the visualizations</a>
            </div>
        </div> <!-- end of .row -->

        <div class="row spaced">
            <div class="col-md-12">
                <h2 class="centered">Contribution Reports</h2>
            </div>
        </div> <!-- end of .row -->

        <div class="row">
            <div class="col-md-6">
                <h3>Jeremy</h3>
                <p>
                    More details are available in our <a target="_blank" href="https://github.com/jeremy-jtlo/iat355/commits/master">github commit logs</a>.
                </p>
                <h4 class="spaced">Summary</h4>
                <p>
                    Handled code refactoring and new architecture, small multiple graphs, page layout, CSS, helper function creation, and general fixes to display issues. The new architecture relies on a <code>$( document ).ready()</code>, calling 3 general functions after the ready statement finishes. The full codebase is available in our <a target="_blank" href="https://github.com/jeremy-jtlo/iat355/">github repo</a>.
                </p>
                <strong class="spaced">getDataRange(), dateSortAsc(), sortObjByDate(), numberWithCommas()</strong>
                <p>
                    Helper functions used in the deeper sections of code. Useful for pulling data from individual columns, sorting objects, and formatting strings for output.
                </p>
                <h4 class="spaced">listing()</h4>
                <ul>
                    <li>
                        fixListingRow()
                        <ul>
                            <li>Cleans data from the CSV file, returning Date() objects and numbers rather than strings</li>
                        </ul>
                    </li>
                    <li>
                        returnDataSet()
                        <ul>
                            <li>Reads an input data set and returns a list of entries matching a desired user criteria, based on the listing type and the region.</li>
                        </ul>
                    </li>
                    <li>
                        drawListAxes()
                        <ul>
                            <li>Draws the x and y axis on some target visualization based on given x/y scales and data set</li>
                        </ul>
                    </li>
                    <li>
                        visAppend()
                        <ul>
                            <li>Appends a &lt;path&gt; and &lt;circle&gt; objects to the desired visualization, based on the specified data set and scale parameters. Classes for the drawn lines and circles are added here for CSS styling later on.</li>
                        </ul>
                    </li>
                </ul>
                <p>
                    For the actual drawing of the graphs, 3 separate Draw() functions were called, each leveraging the helper functions to help reduce duplicate code.
                </p>
                <p>
                    Apart from creating the above structures, Jeremy’s duties included bug fixes, support, and the implementation of desired features like adding data points to the line graphs or scale correction. Data hovering and d3 tooltips were handled in Ernie’s work, along with the foundation work required to draw the population and HPI-income graphs.
                </p>
            </div>
            <div class="col-md-6">
                <h3>Ernie</h3>
                <p>
                    Throughout the entire project, I was primarily responsible for gathering data and cleaning that data as well as assisting with the coding. For gathering data, I pulled open data from Surrey’s official website and I cleaned them up manually by both combining and excluding data. For my contribution in the programming, I followed Jeremy’s code architecture to build both the “Population” visualization and the “HPI vs Income” visualization.
                </p>
                <p>
                    For both <strong>pairedBars()</strong> and <strong>population()</strong>, each visualization contains these functions:
                </p>
                <ul>
                    <li>
                        fixListingRow()
                        <ul>
                            <li>Helps convert incoming CSV data into strings and Date() objects</li>
                        </ul>
                    </li>
                    <li>
                        returnDataSet()
                        <ul>
                            <li>Returns the criteria that is desired for that specific piece of data, in the case of these two visualizations, it is the region. </li>
                        </ul>
                    </li>
                    <li>
                        drawListAxes()
                        <ul>
                            <li>Draws the x and y axis based on xscale and yscale, including the ticks for both population and HPI-Income graphs</li>
                        </ul>
                    </li>
                    <li>
                        visAppend()
                        <ul>
                            <li>Appends the lines and the circles for the population visualization and appends the bars for the HPI vs Income visualization.</li>
                        </ul>
                    </li>
                </ul>
                <p>
                    In addition to building these two visualizations, I also built the hover interaction to all of our visualizations. I searched online and found the d3-tip library and implemented it into all of our visualizations. The css styling for the tooltip is done by Jeremy.
                </p>
                <ul>
                    <li>
                        var tip = d3.tip()
                        <ul>
                            <li>Initializes the tooltip by referencing the library</li>
                        </ul>
                    </li>
                    <li>
                        var svg = d3.select("body").append("svg")
                        <ul>
                            <li>Creates a svg on the body, separate from the visualizations</li>
                        </ul>
                    </li>
                    <li>
                        svg.call(tip);
                        <ul>
                            <li>Invoking tip in context of visualization</li>
                        </ul>
                    </li>
                </ul>
                <p>
                    In the append functions, I used .selectAll() to select all elements for the tip to highlight over. In the case of the bar chart, I used target_vis.selectAll("rect") including the following attributes:
                </p>
                <ul>
                    <li>
                        .on('mouseover', tip.show)
                        <ul>
                            <li>When mouse hovers over a piece of data such as a circle or a bar, show the tip at that location</li>
                        </ul>
                    </li>
                    <li>
                        .on('mouseout', tip.hide)
                        <ul>
                            <li>When the mouse leaves that piece of data, hide the tip</li>
                        </ul>
                    </li>
                </ul>
                <p>
                    Some of my other contributions are bug fixing, general coding support, and testing.
                </p>
            </div>
        </div> <!-- end of .row -->

        <div class="row">
            <div class="col-md-6">
                <h3>Bibliography &amp; Resources</h3>
                <ul>
                    <li><a target="_blank" href="http://code.tutsplus.com/tutorials/building-a-multi-line-chart-using-d3js--cms-22935">Line Chart Tutorial</a></li>
                    <li><a target="_blank" href="https://onpub.com/how-to-sort-an-array-of-dates-with-javascript-s7-a109">Sorting Date Objects</a></li>
                    <li><a target="_blank" href="http://stackoverflow.com/questions/19430561/how-to-sort-a-javascript-array-of-objects-by-date">Sort Objects by Date Key</a></li>
                    <li><a target="_blank" href="http://www.surrey.ca/business-economic-development/1418.aspx">Population Data Source</a></li>
                    <li><a target="_blank" href="https://jquery.com/download/">jQuery</a></li>
                    <li><a target="_blank" href="https://www.surrey.ca/files/Income_%28Total%29_Demographic_Profile.pdf">Income Data</a></li>
                    <li><a target="_blank" href="http://www.rebgv.org/home-price-index">Housing Price Index Data</a></li>
                    <li><a target="_blank" href="http://stackoverflow.com/questions/2901102/how-to-print-a-number-with-commas-as-thousands-separators-in-javascript">Converting Numbers to Comma-separated Strings</a></li>
                    <li><a target="_blank" href="https://github.com/Caged/d3-tip">Hovering D3 Tooltip Library</a></li>
                </ul>
            </div>
            <div class="col-md-6">
                <h3>See Also</h3>
                <ul>
                    <li><a href="index.html">Back to the visualizations</a></li>
                    <li><a target="_blank" href="https://github.com/jeremy-jtlo/iat355">Our Github Repo</a></li>

                </ul>
            </div>
        </div> <!-- end of .row -->

    </div> <!-- end of .container -->

    <!-- include libraries and data -->
    <script src="lib/jquery-2.2.1.min.js"></script>
    <script src="lib/d3tip.js"></script>
    <script src="js/visualize.js"></script>

</body>
</html>